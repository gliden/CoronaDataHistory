<!doctype html>
<html lang="de">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.bundle.min.js"
        integrity="sha512-SuxO9djzjML6b9w9/I07IWnLnQhgyYVSpHZx0JV97kGBfTIsUYlWflyuW4ypnvhBrslz1yJ3R+S14fdCWmSmSA=="
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.css"
        integrity="sha512-C7hOmCgGzihKXzyPU/z4nv97W0d9bv4ALuuEbSf6hm93myico9qa0hv4dODThvCsqQUmKmLcJmlpRmCaApr83g=="
        crossorigin="anonymous" />

    <title>Corona Dashboard</title>
</head>

<body>
    <div class="d-none card-group" id="chartContainer">
        <div class="card" style="position: relative; height:40vh; width:80vw;">
            <div class="card-body">
                <h5 class="card-title">Inzidenz-Werte</h5>
                <canvas id="revenueChart"></canvas>
            </div>
        </div>
    </div>

    <div class="d-flex justify-content-center" id="spinner">
        <div class="spinner-border" role="status">
          <span class="sr-only">Loading...</span>
        </div>
      </div>

    <script>
        window.chartColors = {
            red: 'rgb(255, 99, 132)',
            orange: 'rgb(255, 159, 64)',
            yellow: 'rgb(255, 205, 86)',
            green: 'rgb(75, 192, 192)',
            blue: 'rgb(54, 162, 235)',
            purple: 'rgb(153, 102, 255)',
            grey: 'rgb(201, 203, 207)'
        };

        

        var updateRequest = new XMLHttpRequest();
        updateRequest.addEventListener('load', function(event) {
            updateGraph();
            document.body.removeChild(document.getElementById("spinner"));
            $('#chartContainer').removeClass('d-none');
        });
        updateRequest.open("GET", "update.php");
        updateRequest.send('');

        function updateGraph() {
            var request = new XMLHttpRequest();
            request.addEventListener('load', function(event) {
                if (request.status >= 200 && request.status < 300) {
                    var ctx = document.getElementById('revenueChart').getContext('2d');
                    document.getElementById('revenueChart').height='100';


                    var json = JSON.parse(request.responseText);
                    var labels = json[0].data.map(function(e) {
                        return e.x;
                        }); 
                    
                    var data = {
                        labels: labels,
                        datasets: json
                    }

                    var myLineChart = new Chart(ctx, {
                        type: 'line',
                        data: data
                    });
                } else {
                    console.warn(request.statusText, request.responseText);
                }
            });
            request.open("GET","get.php");
            request.setRequestHeader('objectIds', '47,50');
            request.send('');
        }

        
    </script>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
</body>

</html>